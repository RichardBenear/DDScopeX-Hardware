Appendix A – ODrive Motor Configuration
Download the ODrive Tool before starting.
# Start the ODrive Tool in a terminal window
C:>odrivetool

# If necessary, Wipe the configuration
odrv0.erase_configuration()

# TOP LEVEL CONFIGURATION
# Set up some basic parameters
odrv0.config.enable_brake_resistor=True
odrv0.config.brake_resistance = 1.0
odrv0.config.gpio5_mode=0

###########################################
## AXIS 0 SETUP - Altitude Motor
###########################################
# Motor
odrv0.axis0.motor.config.pre_calibrated=False
odrv0.axis0.motor.config.calibration_current = 5
odrv0.axis0.motor.config.pole_pairs = 10
odrv0.axis0.motor.config.current_lim = 60
odrv0.axis0.motor.config.torque_constant = 0.002
odrv0.axis0.motor.config.motor_type = MOTOR_TYPE_HIGH_CURRENT
odrv0.axis0.motor.config.resistance_calib_max_voltage = 13.0
odrv0.axis0.motor.config.current_control_bandwidth = 10

# Encoder
odrv0.axis0.encoder.config.pre_calibrated=False
odrv0.axis0.encoder.config.cpr = 16384	
odrv0.axis0.encoder.config.use_index = False
odrv0.axis0.encoder.config.mode=256
odrv0.axis0.encoder.config.abs_spi_cs_gpio_pin=6
odrv0.axis0.encoder.config.bandwidth=800

# Controller
odrv0.axis0.controller.config.vel_limit = 1.0
odrv0.axis0.controller.config.vel_limit_tolerance=1.4
odrv0.axis0.controller.config.vel_gain=0.3
odrv0.axis0.controller.config.vel_integrator_gain=.4
odrv0.axis0.controller.config.pos_gain=1.0
odrv0.axis0.controller.config.control_mode=CONTROL_MODE_POSITION_CONTROL
odrv0.axis0.controller.config.input_mode=TRAP_TRAJ
odrv0.axis0.controller.config.homing_speed=.25
odrv0.axis0.controller.config.torque_ramp_rate=.1
odrv0.axis0.controller.config.vel_ramp_rate=0.05
odrv0.axis0.controller.config.inertia=0.05
odrv0.axis0.controller.config.input_filter_bandwidth=10.0
# Trapezoidal Trajectory settings
odrv0.axis0.trap_traj.config.vel_limit=.02
odrv0.axis0.trap_traj.config.accel_limit=.01
odrv0.axis0.trap_traj.config.decel_limit=.01

######### Calibration ##########
# Only needs performed once since there is an absolute encoder.
# Run the calibration. Motor should have little or no load (resistance to rotation).
odrv0.axis0.requested_state = AXIS_STATE_FULL_CALIBRATION_SEQUENCE

dump_errors(odrv0)
# If no errors then save the configuation and reboot
odrv0.axis0.encoder.config.pre_calibrated = True
odrv0.axis0.motor.config.pre_calibrated = True

# Save the config
odrv0.save_configuration()
odrv0.reboot()

# At this point you can test with the following commands to see how the motor performs,
# Motor may jerk or oscillate until some load is applied. Reduce the gains temporarily if
#	you want to experiment in the unloaded state.
odrv0.axis0.requested_state = AXIS_STATE_CLOSED_LOOP_CONTROL
odrv0.axis0.controller.input_pos = .1
# this should turn the motor 0.1 of a turn or 36 deg

# Optional: Run Anticogging
The anticogging feature helps eliminate the "bumpy" feeling of BLDC motors at low speeds by building a torque compensation map. The motor should have no load attached to the shaft.

You need to set the calibration parameters. These values define how fast the motor spins during the mapping process and how much torque it can apply to "fight" the cogging.

# Set the maximum torque the anticogging algorithm is allowed to apply
odrv0.axis0.config.anticogging.max_torque = 0.1  # Start low, e.g., 0.1 Nm

# Set the calibration velocities (turns/sec)
odrv0.axis0.config.anticogging.calib_start_vel = 1.0
odrv0.axis0.config.anticogging.calib_end_vel = 0.1

# Set the integrator gain for the calibration (helps follow the map accurately)
odrv0.axis0.config.anticogging.calib_coarse_integrator_gain = 10.0

Running the Calibration
The calibration process will rotate the motor back and forth to map the cogging torque across a full
revolution.
1.	Enter Closed Loop: Ensure the motor is powered and holding position. 
odrv0.axis0.requested_state = AXIS_STATE_CLOSED_LOOP_CONTROL
2.	Start Calibration: 
odrv0.axis0.requested_state = AXIS_STATE_ANTICOGGING_CALIBRATION
3.	Wait: The motor will begin a slow, multi-phase rotation. This typically takes 6–10 minutes. Do not disturb the motor during this time.
4.	Verify: Once the motor stops moving and returns to IDLE or stays in CLOSED_LOOP, check if the map is valid: 
odrv0.axis0.controller.anticogging_valid (Should return True)

Enabling and Saving
If the calibration was successful, you can now activate the live compensation.
•	Enable: 
odrv0.axis0.config.anticogging.enabled = True
•	Persistent Save: To keep this map after a reboot, you must save the configuration: odrv0.save_configuration()
________________________________________
###########################################
## AXIS 1 SETUP Azimuth Motor
###########################################
# Motor
odrv0.axis1.motor.config.pre_calibrated=False
odrv0.axis1.motor.config.calibration_current = 5
odrv0.axis1.motor.config.pole_pairs = 10
odrv0.axis1.motor.config.current_lim = 60
odrv0.axis1.motor.config.torque_constant = .002
odrv0.axis1.motor.config.motor_type = MOTOR_TYPE_HIGH_CURRENT
odrv0.axis1.motor.config.resistance_calib_max_voltage = 10.0
odrv0.axis1.motor.config.current_control_bandwidth = 10

# Encoder
odrv0.axis1.encoder.config.pre_calibrated=False
odrv0.axis1.encoder.config.cpr = 16384	
odrv0.axis1.encoder.config.use_index = False
odrv0.axis1.encoder.config.mode=256
odrv0.axis1.encoder.config.abs_spi_cs_gpio_pin=8
odrv0.axis1.encoder.config.bandwidth=500

# Controller
odrv0.axis1.controller.config.vel_limit = 0.15
odrv0.axis1.controller.config.vel_gain=1.5
odrv0.axis1.controller.config.vel_integrator_gain=2.0
odrv0.axis1.controller.config.pos_gain=3
odrv0.axis1.controller.config.control_mode=CONTROL_MODE_POSITION_CONTROL
odrv0.axis1.controller.config.input_mode=TRAP_TRAJ
odrv0.axis1.controller.config.torque_ramp_rate=.3
odrv0.axis1.controller.config.vel_ramp_rate=.05
odrv0.axis1.controller.config.inertia=.2 
odrv0.axis1.controller.config.input_filter_bandwidth=10.0

Trapezoidal Trajectory settings
odrv0.axis1.trap_traj.config.vel_limit=.02
odrv0.axis1.trap_traj.config.accel_limit=.01
odrv0.axis1.trap_traj.config.decel_limit=.01

######### Calibration ##########
# Only needs performed once since there is an absolute encoder.
# Run the calibration. Motor should have little or no load (resistance to rotation).
odrv0.axis1.requested_state = AXIS_STATE_FULL_CALIBRATION_SEQUENCE

dump_errors(odrv0)
# If no errors then save the configuation and reboot
odrv0.axis1.encoder.config.pre_calibrated = True
odrv0.axis1.motor.config.pre_calibrated = True

######### Calibration ##########
# Only needs performed once since there is an absolute encoder.
# Motor should have little or no load (resistance to rotation).
# Run the calibration. 
odrv1.axis1.requested_state = AXIS_STATE_FULL_CALIBRATION_SEQUENCE

odrv1.axis1.encoder.config.pre_calibrated = True
odrv1.axis1.motor.config.pre_calibrated = True

# Save the config
odrv0.save_configuration()
odrv0.reboot()

# At this point you can test with the following commands to see how the motor performs,
# Motor may jerk or oscillate until some load is applied. Reduce the gains temporarily if
#	you want to experiment in the unloaded state.
odrv1.axis1.requested_state = AXIS_STATE_CLOSED_LOOP_CONTROL

# Run anticogging the same as axis0 but on axis1
odrv0.save_configuration()

________________________________________
##########################################
# Startup procedure from now on
##########################################
# Put the controller in position mode
odrv0.axis1.controller.config.control_mode = CONTROL_MODE_POSITION_CONTROL
odrv0.axis1.requested_state = AXIS_STATE_CLOSED_LOOP_CONTROL

IMPORTANT!! Never move Azimuth axis more than + or - 0.5 turn with
forks and OTA attached to base because cables may not be long enough!!

# try a small move (0.2 of a turn)
odrv0.axis1.controller.input_pos = 0.2
